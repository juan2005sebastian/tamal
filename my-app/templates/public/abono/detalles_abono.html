{% extends 'public/base_cpanel.html' %}

<!-- Cambiando el title -->
{% block title %}Crud con Python üêç | Detalles de Abono{% endblock %}

<!-- Inicio del block -->
{% block body %}
{{ super() }}

<link rel="stylesheet" href="{{ url_for('static', filename='assets/css/detalles.css') }}" />

<!---->
{% if abono_pedido %}
<div class="card" style="border-radius: 0px !important">
  <div class="row justify-content-center mb-2">
    <div class="col-md-12">
      <h3 class="text-center mt-5 mb-3">
        <a href="/lista-de-abonos">
          <i class="bi bi-arrow-left-circle"></i>
        </a>
        INFORMACI√ìN DEL ABONO
      </h3>
      <hr />
    </div>
  </div>

  <!-- Mensaje de contexto -->
  <div class="context-indicator d-flex align-items-center">
    <i class="bi bi-currency-dollar context-icon"></i>
    <div>
      <h6 class="mb-1">Vista de detalles de abono</h6>
    </div>
  </div>

  <div class="row justify-content-center mb-2">
    <div class="col-md-10">
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <label for="abono_id" class="form-label">
              ID del Abono
            </label>
            <br />
            {{ abono_pedido.abono_id }}
          </div>
          <div class="col-md-6">
            <label for="numero_abonos" class="form-label">
              N√∫mero de Abono
            </label>
            <br />
            {{ abono_pedido.numero_abonos }}
          </div>
        </div>

        <div class="row mt-2">
          <div class="col-md-6">
            <label for="estado_abono" class="form-label">
              Estado del Abono
            </label>
            <br />
            {{ abono_pedido.estado_abono }}
          </div>
          <div class="col-md-6">
            <label for="monto" class="form-label">
              Monto del Abono
            </label>
            <br />
            $ {{ '{:,.0f}'.format(abono_pedido.monto).replace(',', '.') if abono_pedido.monto is not none else 'No disponible' }}
          </div>
        </div>

        <div class="row mt-2">
          <div class="col-md-6">
            <label for="abono_final" class="form-label">
              Abono Final
            </label>
            <br />
            {{ abono_pedido.abono_final if abono_pedido.abono_final else 'No disponible' }}
          </div>
          <div class="col-md-6">
            <label for="pedido_id" class="form-label">
              ID del Pedido
            </label>
            <br />
            {{ abono_pedido.pedido_id }}
          </div>
        </div>

        <div class="row mt-2">
          <div class="col-md-6">
            <label for="fecha_pedido" class="form-label">
              Fecha del Pedido
            </label>
            <br />
            {{ abono_pedido.fecha_pedido }}
          </div>
          <div class="col-md-6">
            <label for="fechaEntrega" class="form-label">
              Fecha de Entrega
            </label>
            <br />
            {{ abono_pedido.fechaEntrega }}
          </div>
        </div>
        
        <div class="row mt-2">
          <div class="col-md-6">
            <label for="horaEntrega" class="form-label">
              Hora de Entrega
            </label>
            <br />
            {{ abono_pedido.horaEntrega }}
          </div>
          <div class="col-md-6">
            <label for="estado_pedido" class="form-label">
              Estado del Pedido
            </label>
            <br />
            {{ abono_pedido.estado_pedido }}
          </div>
        </div>
        
        <div class="row mt-2">
          <div class="col-md-6">
            <label for="total" class="form-label">
              Total del Pedido
            </label>
            <br />
            $ {{ '{:,.0f}'.format(abono_pedido.total).replace(',', '.') if abono_pedido.total is not none else 'No disponible' }}
          </div>
          <div class="col-md-6">
            <label for="nombre_usuario" class="form-label">
              Nombre del Usuario
            </label>
            <br />
            {{ abono_pedido.nombre_usuario }}
          </div>
        </div>
        
        <div class="row mt-2">
          <div class="col-md-12 text-center mt-4">
            <button id="btnDescargarPDF" class="btn btn-danger btn-lg" style="
              border-radius: 10px;
              padding: 12px 30px;
              background: linear-gradient(135deg, #dc3545, #c82333);
              border: none;
              color: white;
              font-weight: 600;
              box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
              transition: all 0.3s ease;
            ">
              <i class="bi bi-file-earmark-pdf me-2" style="font-size: 1.2rem;"></i>Descargar PDF
            </button>
            <button id="btnDescargarImagen" class="btn btn-success btn-lg" style="
              border-radius: 10px;
              padding: 12px 30px;
              background: linear-gradient(135deg, #28a745, #218838);
              border: none;
              color: white;
              font-weight: 600;
              box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
              transition: all 0.3s ease;
              margin-left: 20px;
            ">
              <i class="bi bi-image me-2" style="font-size: 1.2rem;"></i>Descargar Imagen
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% else %}
<h2 class="text-center" style="color: #e74c3c; font-weight: bold;">
  No existe el Abono o el Pedido asociado üò≠
  <hr style="border-top: 2px solid #e74c3c;" />
</h2>
{% endif %}

<script>
  document.getElementById('btnDescargarPDF').addEventListener('click', function () {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    doc.setFont("helvetica", "bold");
    doc.setFontSize(18);
    doc.text("Detalles del Abono", 105, 20, null, null, "center");
    doc.setFontSize(12);
    doc.text("Informaci√≥n detallada del abono", 105, 30, null, null, "center");
    
    const abonoContent = document.querySelector('.card-body').innerText;
    doc.setFont("helvetica", "normal");
    doc.setFontSize(10);
    doc.text(abonoContent, 10, 50);
    
    doc.setFontSize(10);
    doc.text("Gracias por su transacci√≥n!", 105, 280, null, null, "center");
    
    doc.save('detalles_abono.pdf');
  });

  document.getElementById('btnDescargarImagen').addEventListener('click', function() {
    // C√≥digo para descargar como imagen
    alert('Funcionalidad de descarga de imagen en desarrollo');
  });
</script>

{% endblock %}