{% extends 'public/base_cpanel.html' %}

<!-- Cambiando el title -->
{% block title %}Crud con Python üêç | Detalles de Factura{% endblock %}

<!-- Inicio del block -->
{% block body %}
{{ super() }}

<link rel="stylesheet" href="{{ url_for('static', filename='assets/css/detalles.css') }}" />

<!---->
{% if factura_pedido %}
<div class="card" style="border-radius: 0px !important">
  <div class="row justify-content-center mb-2">
    <div class="col-md-12">
      <h3 class="text-center mt-5 mb-3">
        <a href="/lista-de-facturas">
          <i class="bi bi-arrow-left-circle"></i>
        </a>
        INFORMACI√ìN DE LA FACTURA
      </h3>
      <hr />
    </div>
  </div>

  <!-- Mensaje de contexto -->
  <div class="context-indicator d-flex align-items-center">
    <i class="bi bi-receipt context-icon"></i>
    <div>
      <h6 class="mb-1">Vista de detalles de factura</h6>
    </div>
  </div>

  <div class="row justify-content-center mb-2">
    <div class="col-md-10">
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <label for="factura_id" class="form-label">
              ID de la Factura
            </label>
            <br />
            {{ factura_pedido.factura_id }}
          </div>
          <div class="col-md-6">
            <label for="estado_factura" class="form-label">
              Estado de la Factura
            </label>
            <br />
            {{ factura_pedido.estado_factura }}
          </div>
        </div>

        <div class="row mt-2">
          <div class="col-md-6">
            <label for="fecha_factura" class="form-label">
              Fecha de la Factura
            </label>
            <br />
            {{ factura_pedido.fecha_factura }}
          </div>
          <div class="col-md-6">
            <label for="fechaEntrega" class="form-label">
              Fecha de Entrega
            </label>
            <br />
            {{ factura_pedido.fechaEntrega }}
          </div>
        </div>

        <div class="row mt-2">
          <div class="col-md-6">
            <label for="horaEntrega" class="form-label">
              Hora de Entrega
            </label>
            <br />
            {{ factura_pedido.horaEntrega }}
          </div>
          <div class="col-md-6">
            <label for="total" class="form-label">
              Total del Pedido
            </label>
            <br />
            {% if factura_pedido.total is not none %}
              $ {{ '{:,.0f}'.format(factura_pedido.total).replace(',', '.') }}
            {% else %}
              No disponible
            {% endif %}
          </div>
        </div>

        <div class="row mt-2">
          <div class="col-md-6">
            <label for="nombre_usuario" class="form-label">
              Nombre del Usuario
            </label>
            <br />
            {{ factura_pedido.nombre_usuario }}
          </div>
          <div class="col-md-6">
            <label for="nombre_producto" class="form-label">
              Nombre del Producto
            </label>
            <br />
            {{ factura_pedido.nombre_producto }}
          </div>
        </div>
        
        <div class="row mt-2">
          <div class="col-md-6">
            <label for="metodo_pago" class="form-label">
              M√©todo de Pago
            </label>
            <br />
            {{ factura_pedido.metodo_pago }}
          </div>
        </div>
        
        <div class="row mt-2">
          <div class="col-md-12 text-center mt-4">
            <button id="btnDescargarPDF" class="btn btn-danger btn-lg" style="
              border-radius: 10px;
              padding: 12px 30px;
              background: linear-gradient(135deg, #dc3545, #c82333);
              border: none;
              color: white;
              font-weight: 600;
              box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
              transition: all 0.3s ease;
            ">
              <i class="bi bi-file-earmark-pdf me-2" style="font-size: 1.2rem;"></i>Descargar PDF
            </button>
            <button id="btnDescargarImagen" class="btn btn-success btn-lg" style="
              border-radius: 10px;
              padding: 12px 30px;
              background: linear-gradient(135deg, #28a745, #218838);
              border: none;
              color: white;
              font-weight: 600;
              box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
              transition: all 0.3s ease;
              margin-left: 20px;
            ">
              <i class="bi bi-image me-2" style="font-size: 1.2rem;"></i>Descargar Imagen
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% else %}
<h2 class="text-center" style="color: #e74c3c; font-weight: bold;">
  No existe la Factura o el Pedido asociado üò≠
  <hr style="border-top: 2px solid #e74c3c;" />
</h2>
{% endif %}

<script>
  document.getElementById('btnDescargarPDF').addEventListener('click', function () {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    doc.setFont("helvetica", "bold");
    doc.setFontSize(18);
    doc.text("Factura de Compra", 105, 20, null, null, "center");
    doc.setFontSize(12);
    doc.text("Los mejores tamales de la regi√≥n", 105, 30, null, null, "center");
    
    const facturaContent = document.querySelector('.card-body').innerText;
    doc.setFont("helvetica", "normal");
    doc.setFontSize(10);
    doc.text(facturaContent, 10, 50);
    
    doc.setFontSize(10);
    doc.text("Gracias por su compra!", 105, 280, null, null, "center");
    
    doc.save('factura.pdf');
  });

  document.getElementById('btnDescargarImagen').addEventListener('click', function() {
    // C√≥digo para descargar como imagen
    alert('Funcionalidad de descarga de imagen en desarrollo');
  });
</script>

{% endblock %}